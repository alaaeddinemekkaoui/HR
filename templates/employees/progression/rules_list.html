{% extends 'base.html' %}
{% block title %}Grade Rules{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3">Grade Progression Rules</h1>
  {% if perms.employees.add_gradeprogressionrule %}
  <a class="btn btn-primary" href="{% url 'employees:rule_create' %}"><i class="bi bi-plus-circle"></i> New Rule</a>
  {% endif %}
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>From</th>
            <th>To</th>
            <th>With Exam</th>
            <th>Without Exam</th>
            <th>Active</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for r in rules %}
          <tr>
            <td>{{ r.source_grade.name }}</td>
            <td>{{ r.target_grade.name }}</td>
            <td>{% if r.years_with_exam %}{{ r.years_with_exam }} years{% else %}-{% endif %}</td>
            <td>{% if r.years_without_exam %}{{ r.years_without_exam }} years{% else %}-{% endif %}</td>
            <td>{% if r.is_active %}<span class="badge bg-success">Yes</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</td>
            <td class="text-end">
              {% if perms.employees.change_gradeprogressionrule %}
              <a class="btn btn-sm btn-outline-primary" href="{% url 'employees:rule_edit' r.id %}">Edit</a>
              {% endif %}
              {% if perms.employees.delete_gradeprogressionrule %}
              <form method="post" action="{% url 'employees:rule_delete' r.id %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-center text-muted p-4">No rules yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
