{% extends 'base.html' %}
{% load roles_extras %}
{% block title %}Modèles dynamiques{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-1">Modèles dynamiques</h1>
    <p class="text-muted mb-0">Créer et modifier des modèles de documents (Réservé RH)</p>
  </div>
  <a href="{% url 'documents:template_create' %}" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Nouveau modèle</a>
</div>

<div class="card border-0 shadow-sm">
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Nom</th>
          <th>Slug</th>
          <th>RH seulement</th>
          <th>Actif</th>
          <th>Mis à jour</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for t in templates %}
        <tr>
          <td class="fw-semibold">{{ t.name }}</td>
          <td class="text-muted">{{ t.slug }}</td>
          <td>{% if t.hr_only %}<span class="badge bg-warning text-dark">Oui</span>{% else %}<span class="badge bg-success">Non</span>{% endif %}</td>
          <td>{% if t.is_active %}<span class="badge bg-success">Actif</span>{% else %}<span class="badge bg-secondary">Inactif</span>{% endif %}</td>
          <td class="text-muted small">{{ t.updated_at|date:"Y-m-d H:i" }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'documents:template_render' t.slug %}"><i class="bi bi-file-earmark-text"></i> Générer</a>
            <a class="btn btn-sm btn-outline-primary" href="{% url 'documents:template_edit' t.id %}"><i class="bi bi-pencil"></i></a>
            <form method="post" action="{% url 'documents:template_delete' t.id %}" class="d-inline" onsubmit="return confirm('Supprimer ce modèle ?');">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-center text-muted p-4">Aucun modèle</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
